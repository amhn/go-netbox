---
name: PR

on:
  pull_request:

jobs:
  Build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Check conventional commits in PR
        uses: Namchee/conventional-pr@v0.4.1
        with:
          access_token: ${{ secrets.github_token }}
          label: "no-conventional-commits"
          close: false
          template: "Thank you for your contribution attempt in this repository!\n\nUnfortunately, this pull request doesn't meet our standards by reason we stated below.\nFor future pull requests, please use conventional commits.\nPlease update the commits in this PR with conventional commits rules."
          strict: false

      - name: Checkout
        uses: actions/checkout@v2.3.4

      - name: Unshallow
        run: git fetch --prune --unshallow

      - name: Setup env
        run: |
          echo "GOPATH=$(dirname $GITHUB_WORKSPACE)" >> $GITHUB_ENV
          echo "$(dirname $GITHUB_WORKSPACE)/bin" >> $GITHUB_PATH
          mkdir -p "$(dirname $GITHUB_WORKSPACE)/src/github.com/smutel"
          ln -sf "$GITHUB_WORKSPACE/" "$(dirname $GITHUB_WORKSPACE)/src/github.com/smutel/go-netbox"
        shell: bash

      - name: Generate netbox client
        run: |
          sudo apt-get -q install python3-demjson
          cd "$GITHUB_WORKSPACE/utils"
          ./netbox_generate_client
        shell: bash
